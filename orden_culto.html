<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Gesti√≥n de Culto - IASD Limache</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800;900&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        adventist: { blue: '#00305e', gold: '#fec325', soft: '#f1f5f9' }
                    }
                }
            }
        }
    </script>

    <style>
        body { background: radial-gradient(circle at top, #f8fafc, #e2e8f0); min-height: 100vh; font-family: 'Open Sans', sans-serif; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.5); border-radius: 2.5rem; }
        .input-premium { background: #f8fafc; border: 2px solid transparent; transition: all 0.3s; border-radius: 1rem; padding: 0.75rem 1rem; width: 100%; font-weight: 600; color: #1e3a8a; }
        .input-premium:focus { border-color: #fec325; background: white; outline: none; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .section-label { color: #00305e; font-family: 'Montserrat'; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; font-size: 0.75rem; margin-bottom: 0.5rem; display: block; }
        
        /* Estilos para el PDF */
        .pdf-page { width: 210mm; min-height: 297mm; background: white; padding: 20mm; font-family: sans-serif; color: #333; box-sizing: border-box; }
        .pdf-header-border { border-top: 15px solid #00305e; padding-top: 15px; text-align: center; margin-bottom: 30px; }
        .pdf-section { background: #00305e; color: white; padding: 8px 15px; border-radius: 10px; font-weight: bold; margin: 20px 0 10px; text-transform: uppercase; }
        .pdf-item { border-left: 5px solid #fec325; background: #f9fafb; padding: 12px; margin-bottom: 10px; border-radius: 5px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <div class="bg-adventist-blue inline-block p-3 rounded-2xl shadow-xl mb-4">
                <i class="fas fa-church text-adventist-gold text-3xl"></i>
            </div>
            <p class="text-adventist-blue font-black text-xs uppercase tracking-[0.3em]">Iglesia Adventista del S√©ptimo D√≠a</p>
            <h1 class="text-3xl md:text-5xl font-black text-adventist-blue tracking-tighter uppercase leading-none mt-2">
                San Francisco de <span class="text-adventist-gold italic">Limache</span>
            </h1>
            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-4 block">Planificaci√≥n creada por MGE</span>
        </header>

        <div class="glass-card shadow-2xl p-6 md:p-12 mb-10">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                <div>
                    <label class="section-label"><i class="fas fa-calendar-alt mr-2 text-adventist-gold"></i>S√°bado Fecha</label>
                    <input type="date" id="fecha" class="input-premium">
                </div>
                <div>
                    <label class="section-label"><i class="fas fa-microphone-alt mr-2 text-adventist-gold"></i>Predicador(a)</label>
                    <input type="text" id="predicador" placeholder="Nombre completo" class="input-premium">
                </div>
            </div>

            <div class="space-y-8">
                <div class="p-6 bg-white/50 rounded-[2rem] border border-slate-100">
                    <h3 class="section-label mb-4 text-lg">Bloques 1 y 2: Liturgia Inicial</h3>
                    <div class="grid gap-4">
                        <input type="text" id="previa" placeholder="Himnos Previos" class="input-premium">
                        <input type="text" id="acomp1" placeholder="Nombre Acompa√±ante 1" class="input-premium">
                        <input type="text" id="ofrendas_enc" placeholder="Encargado Ofrendas" class="input-premium">
                        <input type="text" id="himno_i" placeholder="Himno Inicial" class="input-premium">
                    </div>
                </div>

                <div class="p-6 bg-white/50 rounded-[2rem] border border-slate-100">
                    <h3 class="section-label mb-4 text-lg">Bloques 3 y 4: Bloque Espiritual</h3>
                    <div class="grid gap-4">
                        <input type="text" id="acomp2" placeholder="Nombre Acompa√±ante 2" class="input-premium">
                        <input type="text" id="lectura" placeholder="Lectura B√≠blica (Cita)" class="input-premium">
                        <div class="flex gap-2">
                            <select id="infantil" class="input-premium w-1/3">
                                <option value="Video Proyectado">üìΩÔ∏è Video</option>
                                <option value="Relator(a) presente">üë§ Relator</option>
                            </select>
                            <input type="text" id="relatador_nombre" placeholder="Nombre Relator" class="input-premium w-2/3">
                        </div>
                        <input type="text" id="especial" placeholder="Alabanza Especial" class="input-premium">
                        <input type="text" id="himno_f" placeholder="Himno Final" class="input-premium">
                    </div>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 mt-12">
                <button onclick="enviarWhatsApp()" class="flex-1 bg-[#25d366] text-white py-4 rounded-2xl font-black text-xs uppercase shadow-xl hover:scale-105 transition-all flex items-center justify-center gap-2">
                    <i class="fab fa-whatsapp text-lg"></i> Enviar WhatsApp
                </button>
                <button onclick="generarPDFyEnviar()" class="flex-1 bg-adventist-blue text-white py-4 rounded-2xl font-black text-xs uppercase shadow-xl hover:scale-105 transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-file-pdf text-lg"></i> Descargar PDF (2 Hojas)
                </button>
                <button onclick="limpiarFormulario()" class="bg-red-500 text-white p-4 rounded-2xl shadow-xl hover:bg-red-600 transition-all">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        function f(id) { 
            const el = document.getElementById(id);
            return el && el.value ? el.value.trim() : "---"; 
        }

        async function generarPDFyEnviar() {
            const fecha = f("fecha");
            const tempDiv = document.createElement('div');
            // IMPORTANTE: El contenedor debe estar en el DOM para que html2canvas lo procese
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            tempDiv.style.top = '0';
            tempDiv.style.width = '210mm';
            tempDiv.style.background = 'white';

            tempDiv.innerHTML = `
                <div class="pdf-page">
                    <div class="pdf-header-border">
                        <h1 style="color:#00305e; font-size: 24px; margin:0;">IASD SAN FRANCISCO DE LIMACHE</h1>
                        <p style="color:#b45309; font-weight:bold; margin-top:5px;">PLANIFICACI√ìN CULTO - PARTE 1</p>
                    </div>
                    <div style="margin-bottom:30px;">
                        <p><strong>S√ÅBADO:</strong> ${fecha}</p>
                        <p><strong>ACOMPA√ëANTE 1:</strong> ${f("acomp1")}</p>
                        <p><strong>PREDICADOR:</strong> ${f("predicador")}</p>
                    </div>
                    <div class="pdf-section">1. Preludio e Ingreso</div>
                    <div class="pdf-item"><strong>Cantos Previos:</strong> ${f("previa")}</div>
                    <div class="pdf-item"><strong>Ingreso:</strong> Himno 32 (De pie)</div>
                    <div class="pdf-item"><strong>Con Plataforma:</strong> Himno 135</div>
                    <div class="pdf-section">2. Liturgia Central</div>
                    <div class="pdf-item"><strong>Bienvenida y Saludos:</strong> Encargado Acomp. 1</div>
                    <div class="pdf-item"><strong>üìΩÔ∏è Video Proyectado:</strong> Probad y Ved</div>
                    <div class="pdf-item"><strong>Diezmos y Ofrendas:</strong> ${f("ofrendas_enc")}</div>
                    <div class="pdf-item"><strong>Himno Inicial:</strong> ${f("himno_i")}</div>
                </div>
                <div class="pdf-page" style="page-break-before: always;">
                    <div class="pdf-header-border">
                        <h1 style="color:#00305e; font-size: 24px; margin:0;">IASD SAN FRANCISCO DE LIMACHE</h1>
                        <p style="color:#b45309; font-weight:bold; margin-top:5px;">PLANIFICACI√ìN CULTO - PARTE 2</p>
                    </div>
                    <div style="margin-bottom:30px;">
                        <p><strong>S√ÅBADO:</strong> ${fecha}</p>
                        <p><strong>ACOMPA√ëANTE 2:</strong> ${f("acomp2")}</p>
                    </div>
                    <div class="pdf-section">3. Bloque Espiritual</div>
                    <div class="pdf-item"><strong>Lectura B√≠blica:</strong> ${f("lectura")}</div>
                    <div class="pdf-item"><strong>üõê Oraci√≥n Intercesora:</strong> Himno 36 (Fondo)</div>
                    <div class="pdf-item"><strong>Adoraci√≥n Infantil:</strong> ${document.getElementById('infantil').value} (${f('relatador_nombre')})</div>
                    <div class="pdf-item"><strong>Alabanza Musical:</strong> ${f("especial")}</div>
                    <div class="pdf-section">4. Mensaje y Salida</div>
                    <div class="pdf-item"><strong>üìñ Serm√≥n:</strong> ${f("predicador")}</div>
                    <div class="pdf-item"><strong>Himno Final:</strong> ${f("himno_f")}</div>
                    <div class="pdf-item"><strong>Cierre:</strong> Oraci√≥n Final e Himno 41 / 57</div>
                </div>
            `;

            document.body.appendChild(tempDiv);

            const opt = { 
                margin: 0, 
                filename: `Planificacion_Limache_${fecha}.pdf`, 
                image: { type: 'jpeg', quality: 1 }, 
                html2canvas: { scale: 2, useCORS: true, letterRendering: true }, 
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } 
            };
            
            try {
                // Pausa de 500ms para asegurar el renderizado de fuentes y estilos
                await new Promise(r => setTimeout(r, 500));
                await html2pdf().set(opt).from(tempDiv).save();
            } finally {
                document.body.removeChild(tempDiv);
            }
        }

        function enviarWhatsApp() {
            const msj = `üìã *ORDEN DE CULTO - IASD LIMACHE*\n\n` +
                        `üìÖ *Fecha:* ${f("fecha")}\n` +
                        `üé§ *Predicador:* ${f("predicador")}\n` +
                        `ü§ù *Acomp. 1:* ${f("acomp1")}\n` +
                        `üõê *Acomp. 2:* ${f("acomp2")}\n` +
                        `üé∂ *Himnos:* ${f("himno_i")} / ${f("himno_f")}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msj)}`, "_blank");
        }

        function limpiarFormulario() {
            if(confirm("¬øDesea borrar todos los datos?")) {
                document.querySelectorAll('input').forEach(i => i.value = "");
                document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
            }
        }
    </script>
</body>
</html>