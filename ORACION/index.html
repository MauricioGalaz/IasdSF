<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Muro de Oraci√≥n - IASD Limache</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        adventist: { blue: '#00305e', gold: '#fec325', light: '#f4f4f4' }
                    },
                    fontFamily: { sans: ['Open Sans', 'sans-serif'], heading: ['Montserrat', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        .hero-bg-prayer {
            background-image: linear-gradient(rgba(0, 48, 94, 0.8), rgba(0, 48, 94, 0.8)), url('imagenes/oracion.jpg');
            background-size: cover;
            background-position: center;
        }

        .scroll-smooth {
            scroll-behavior: smooth;
        }

        .post-item {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="font-sans text-gray-700 bg-gray-50 scroll-smooth">

    <nav class="bg-adventist-blue text-white shadow-lg fixed w-full z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <img src="imagenes/oracion.jpg"
                    class="h-9 w-9 rounded-full object-cover border-2 border-adventist-gold">
                <span class="font-heading font-bold text-[10px] leading-tight uppercase">IASD<br>San Francisco<br>de
                    Limache</span>
            </div>
            <div class="hidden md:flex space-x-6 text-xs font-bold uppercase">
                <a href="#inicio" class="hover:text-adventist-gold">Inicio</a>
                <a href="#oracion" class="hover:text-adventist-gold">Oraci√≥n</a>
                <a href="#estudio" class="hover:text-adventist-gold">Estudio</a>
            </div>
            <a href="../index.html"
                class="bg-adventist-gold text-adventist-blue px-4 py-2 rounded-lg font-bold text-xs">VOLVER A LA APP</a>
        </div>
    </nav>

    <header id="inicio" class="hero-bg-prayer pt-32 pb-20 px-6 text-center text-white">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-adventist-gold uppercase tracking-widest font-bold mb-2">Bienvenidos a Nuestra Familia de Fe
            </h2>
            <h1 class="font-heading text-3xl md:text-5xl font-bold mb-6 italic">Ministerio de Oraci√≥n Intercesora</h1>
            <p class="italic text-lg">"Porque donde est√°n dos o tres congregados en mi nombre, all√≠ estoy yo en medio de
                ellos."</p>
            <p class="font-bold text-adventist-gold">Mateo 18:20</p>
        </div>
    </header>

    <section class="container mx-auto px-4 -mt-10 relative z-10">
        <div id="wall-metrics" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        </div>
    </section>

    <main class="container mx-auto px-4 py-12">
        <section id="oracion" class="mb-20">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-heading font-bold text-adventist-blue uppercase">Pedidos y Agradecimientos</h2>
                <div class="w-24 h-1 bg-adventist-gold mx-auto mt-2"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="bg-white rounded-2xl shadow-xl p-6 border-t-4 border-adventist-blue h-fit">
                    <h3 class="font-bold text-xl mb-4 text-adventist-blue uppercase"><i
                            class="fas fa-edit mr-2"></i>Nueva Entrada</h3>
                    <form id="prayer-form" class="space-y-4">
                        <input type="text" id="p-name" placeholder="Tu Nombre"
                            class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-adventist-blue outline-none"
                            required>
                        <select id="p-cat"
                            class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-adventist-blue outline-none"
                            required>
                            <option value="">Selecciona Categor√≠a</option>
                            <option value="Salud">Salud</option>
                            <option value="Familia">Familia</option>
                            <option value="Trabajo">Trabajo/Estudios</option>
                            <option value="Espiritual">Vida Espiritual</option>
                            <option value="Agradecimiento">‚ú® Agradecimiento</option>
                        </select>
                        <textarea id="p-req" placeholder="Escribe aqu√≠ tu petici√≥n o testimonio..."
                            class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-adventist-blue outline-none"
                            rows="4" required></textarea>
                        <button type="submit"
                            class="w-full bg-adventist-blue text-white py-3 rounded-xl font-bold hover:bg-slate-800 transition shadow-lg">PUBLICAR
                            EN EL MURO</button>
                    </form>
                </div>

                <div class="lg:col-span-2">
                    <div id="prayers-list" class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                    </div>
                </div>
            </div>
        </section>

        <section id="estudio" class="mb-20 py-10 bg-white rounded-3xl shadow-sm px-6 border border-slate-100">
            <h2 class="text-2xl font-heading font-bold text-adventist-blue text-center mb-10 uppercase tracking-widest">
                Recursos de Estudio</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-slate-50 p-6 rounded-2xl border-l-4 border-adventist-gold">
                    <h4 class="font-bold text-adventist-blue mb-4 uppercase text-sm">Gu√≠as Diarias</h4>
                    <ul class="space-y-3 text-sm font-semibold">
                        <li><a href="https://escuelasabatica.cl/" target="_blank"
                                class="flex items-center text-slate-600 hover:text-adventist-gold"><i
                                    class="fas fa-book mr-2"></i> Lecci√≥n Escuela Sab√°tica</a></li>
                        <li><a href="https://egwwritings.org/" target="_blank"
                                class="flex items-center text-slate-600 hover:text-adventist-gold"><i
                                    class="fas fa-feather mr-2"></i> Escritos de Elena G. White</a></li>
                    </ul>
                </div>
                <div class="bg-slate-50 p-6 rounded-2xl border-l-4 border-adventist-blue">
                    <h4 class="font-bold text-adventist-blue mb-4 uppercase text-sm">Medios</h4>
                    <ul class="space-y-3 text-sm font-semibold">
                        <li><a href="https://www.nuevotiempo.org" target="_blank"
                                class="flex items-center text-slate-600 hover:text-adventist-blue"><i
                                    class="fas fa-tv mr-2"></i> TV Nuevo Tiempo</a></li>
                        <li><a href="#" class="flex items-center text-slate-600 hover:text-adventist-blue"><i
                                    class="fas fa-radio mr-2"></i> Radio Adventista</a></li>
                    </ul>
                </div>
                <div class="bg-slate-50 p-6 rounded-2xl border-l-4 border-adventist-gold">
                    <h4 class="font-bold text-adventist-blue mb-4 uppercase text-sm">Planes de Lectura</h4>
                    <ul class="space-y-3 text-sm font-semibold text-slate-500">
                        <li><i class="fas fa-check-circle mr-2 text-green-500"></i> Plan 365 d√≠as</li>
                        <li><i class="fas fa-clock mr-2 text-adventist-blue"></i> 15-20 min diarios</li>
                    </ul>
                </div>
            </div>
        </section>
        <section id="biblioteca" class="bg-adventist-blue text-white rounded-3xl p-8 md:p-12 mb-20 shadow-2xl">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-heading font-bold mb-4 text-adventist-gold uppercase tracking-wider">Biblioteca
                    de Esperanza</h2>
                <p class="text-slate-300 max-w-2xl mx-auto italic">"Unidos en el estudio de las verdades que transforman
                    el coraz√≥n."</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <div
                    class="bg-white rounded-2xl shadow-xl overflow-hidden border-t-4 border-adventist-gold hover:scale-105 transition-transform duration-300 group">
                    <div class="p-0">
                        <img src="imagenes/el-deseado.jpg" alt="El Deseado de Todas las Gentes"
                            class="w-full h-48 object-cover">
                        <div class="p-6 text-center">
                            <h4 class="font-bold text-lg text-adventist-blue uppercase mb-2">El Deseado de Todas las
                                Gentes</h4>
                            <p class="text-xs text-slate-600 mb-6 italic">La vida de Jes√∫s narrada con profundidad
                                espiritual.</p>
                            <a href="https://egwwritings.org/read?panels=p130.1" target="_blank"
                                class="w-full bg-adventist-blue text-white py-3 rounded-xl font-black text-xs uppercase tracking-widest hover:bg-slate-800 transition shadow-lg flex items-center justify-center gap-2">
                                <i class="fas fa-book-open"></i> LEER LIBRO
                            </a>
                        </div>
                    </div>
                </div>

                <div
                    class="bg-white rounded-2xl shadow-xl overflow-hidden border-t-4 border-adventist-gold hover:scale-105 transition-transform duration-300 group">
                    <div class="p-0">
                        <img src="imagenes/eventos.jpg" alt="Eventos de los √öltimos D√≠as"
                            class="w-full h-48 object-cover">
                        <div class="p-6 text-center">
                            <h4 class="font-bold text-lg text-adventist-blue uppercase mb-2">Eventos de los √öltimos D√≠as
                            </h4>
                            <p class="text-xs text-slate-600 mb-6 italic">Panorama prof√©tico de los sucesos finales de
                                la historia.</p>
                            <a href="https://egwwritings.org/" target="_blank"
                                class="w-full bg-adventist-blue text-white py-3 rounded-xl font-black text-xs uppercase tracking-widest hover:bg-slate-800 transition shadow-lg flex items-center justify-center gap-2">
                                <i class="fas fa-book-open"></i> LEER LIBRO
                            </a>
                        </div>
                    </div>
                </div>

                <div
                    class="bg-white rounded-2xl shadow-xl overflow-hidden border-t-4 border-adventist-gold hover:scale-105 transition-transform duration-300 group">
                    <div class="p-0">
                        <img src="imagenes/conflicto.jpg" alt="El Conflicto de los Siglos"
                            class="w-full h-48 object-cover">
                        <div class="p-6 text-center">
                            <h4 class="font-bold text-lg text-adventist-blue uppercase mb-2">El Conflicto de los Siglos
                            </h4>
                            <p class="text-xs text-slate-600 mb-6 italic">La gran controversia entre el bien y el mal a
                                trav√©s de los siglos.</p>
                            <a href="https://egwwritings.org/read?panels=p132.1" target="_blank"
                                class="w-full bg-adventist-blue text-white py-3 rounded-xl font-black text-xs uppercase tracking-widest hover:bg-slate-800 transition shadow-lg flex items-center justify-center gap-2">
                                <i class="fas fa-book-open"></i> LEER LIBRO
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <div class="fixed bottom-6 right-6 flex flex-col gap-3 z-[100]">
        <button onclick="descargarReportePDF()" title="Descargar PDF"
            class="bg-green-600 text-white p-4 rounded-full shadow-2xl hover:scale-110 transition active:scale-95">
            <i class="fas fa-file-pdf"></i>
        </button>
        <button onclick="menuAdmin()" title="Administraci√≥n"
            class="bg-slate-900 text-white p-4 rounded-full shadow-2xl hover:scale-110 transition active:scale-95 border-2 border-white/20">
            <i class="fas fa-user-shield"></i>
        </button>
    </div>

    <footer class="bg-white py-16 text-center rounded-t-[4rem] border-t border-slate-200 relative">
        <div class="container mx-auto px-6">
            <div class="flex justify-center space-x-8 mb-8">
                <a href="#"
                    class="text-adventist-blue hover:text-adventist-gold transition-transform hover:-translate-y-1"><i
                        class="fab fa-facebook-f fa-2xl"></i></a>
                <a href="#"
                    class="text-adventist-blue hover:text-adventist-gold transition-transform hover:-translate-y-1"><i
                        class="fab fa-instagram fa-2xl"></i></a>
                <a href="#"
                    class="text-adventist-blue hover:text-adventist-gold transition-transform hover:-translate-y-1"><i
                        class="fab fa-youtube fa-2xl"></i></a>
            </div>

            <p
                class="font-heading font-black text-adventist-blue text-2xl md:text-3xl uppercase tracking-tighter mb-6 italic underline decoration-adventist-gold decoration-4">
                IASD SAN FRANCISCO DE LIMACHE
            </p>

            <p
                class="text-slate-500 font-bold uppercase tracking-widest text-sm flex items-center justify-center gap-2">
                Dise√±ado con <i class="fas fa-heart text-red-500 animate-pulse"></i> por <span
                    class="text-slate-900 font-black">MGE</span>
            </p>

            <p class="text-[10px] text-slate-800 mt-8 uppercase tracking-[0.4em] font-bold italic">Esperanza en el
                pronto regreso de Jes√∫s</p>

            <p class="text-[10px] text-slate-400 mt-4 uppercase tracking-[0.2em] font-bold">¬© 2025 DERECHOS RESERVADOS -
                San Francisco de Limache</p>
        </div>
    </footer>

    <script>
        const CLAVE_ADMIN = "iasdsf";

        // BASE DE DATOS LOCAL CON UNIFICACI√ìN
        const iasdDB = {
            save: (key, data) => {
                let list = JSON.parse(localStorage.getItem(key)) || [];
                list.unshift({ ...data, id: Date.now(), date: new Date().toLocaleDateString('es-CL') });
                localStorage.setItem(key, JSON.stringify(list));
                actualizarInterfaz();
            },
            get: (key) => JSON.parse(localStorage.getItem(key)) || [],
            delete: (key, id) => {
                let list = iasdDB.get(key).filter(item => item.id !== id);
                localStorage.setItem(key, JSON.stringify(list));
                actualizarInterfaz();
            },
            clearAll: () => {
                localStorage.removeItem('pedidos');
                actualizarInterfaz();
            }
        };

        function actualizarInterfaz() {
            renderMetrics();
            renderPrayers();
        }

        // M√âTRICAS REALES DIN√ÅMICAS
        function renderMetrics() {
            const data = iasdDB.get('pedidos');
            const container = document.getElementById('wall-metrics');

            const total = data.length;
            const agradecimientos = data.filter(p => p.category === 'Agradecimiento').length;
            const pedidos = total - agradecimientos;

            container.innerHTML = `
                <div class="bg-white p-6 rounded-2xl shadow-lg border-b-4 border-adventist-blue text-center fade-in">
                    <span class="text-[10px] font-black uppercase text-slate-400">Pedidos de Oraci√≥n</span>
                    <p class="text-3xl font-black text-adventist-blue">${pedidos}</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg border-b-4 border-adventist-gold text-center fade-in">
                    <span class="text-[10px] font-black uppercase text-slate-400">Agradecimientos</span>
                    <p class="text-3xl font-black text-adventist-blue">${agradecimientos}</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg border-b-4 border-slate-800 text-center fade-in">
                    <span class="text-[10px] font-black uppercase text-slate-400">Total Mensajes</span>
                    <p class="text-3xl font-black text-adventist-blue">${total}</p>
                </div>
            `;
        }

        function renderPrayers() {
            const list = document.getElementById('prayers-list');
            const data = iasdDB.get('pedidos');

            list.innerHTML = data.map(item => {
                const isThanks = item.category === 'Agradecimiento';
                return `
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-8 ${isThanks ? 'border-adventist-gold' : 'border-adventist-blue'} relative group post-item">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-black uppercase tracking-widest ${isThanks ? 'text-adventist-gold' : 'text-adventist-blue'}">
                                ${isThanks ? '‚ú® GRATITUD' : 'üôè ' + item.category}
                            </span>
                            <button onclick="adminDelete(${item.id})" class="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition duration-300">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                        <p class="text-slate-800 font-medium italic mb-4">"${item.content}"</p>
                        <div class="flex justify-between items-center border-t border-slate-50 pt-3">
                            <span class="text-xs font-bold text-adventist-blue uppercase"><i class="fas fa-user-circle mr-1 text-adventist-gold"></i> ${item.name}</span>
                            <span class="text-[10px] font-bold text-slate-300">${item.date}</span>
                        </div>
                    </div>
                `;
            }).join('') || '<p class="text-center py-20 text-slate-300 font-bold uppercase italic tracking-widest">Muro vac√≠o - Se el primero en compartir</p>';
        }


        // --- EVENTO FORMULARIO ACTUALIZADO ---
        document.getElementById('prayer-form').onsubmit = (e) => {
            e.preventDefault();

            // Capturamos los datos
            const nombre = document.getElementById('p-name').value;
            const categoria = document.getElementById('p-cat').value;
            const contenido = document.getElementById('p-req').value;

            // Guardamos en la base de datos local
            iasdDB.save('pedidos', {
                name: nombre,
                category: categoria,
                content: contenido
            });

            // --- MENSAJE MODERNO DE SOLICITUD EXITOSA (SweetAlert2) ---
            Swal.fire({
                title: '¬°Recibido con Amor!',
                html: 'Tu solicitud ha sido registrada.<br><b style="color: #1e5aa8;">Estaremos orando por ti.</b>',
                icon: 'success',
                iconColor: '#1e5aa8',
                confirmButtonText: 'Am√©n',
                confirmButtonColor: '#1e5aa8',
                background: '#ffffff',
                backdrop: `rgba(30,90,168,0.2) blur(5px)`,
                customClass: {
                    popup: 'modern-swal-popup'
                }
            });

            // Limpiamos el formulario para el siguiente uso
            e.target.reset();
        };

        // ADMINISTRACI√ìN SEGURA
        async function adminDelete(id) {
            const { value: pass } = await Swal.fire({
                title: 'Acceso Administrador',
                input: 'password',
                inputPlaceholder: 'Ingresa la clave iasdsf',
                showCancelButton: true,
                confirmButtonColor: '#00305e'
            });

            if (pass === CLAVE_ADMIN) {
                iasdDB.delete('pedidos', id);
                Swal.fire('Eliminado', '', 'success');
            } else if (pass) {
                Swal.fire('Error', 'Clave incorrecta', 'error');
            }
        }

        async function menuAdmin() {
            const { value: pass } = await Swal.fire({
                title: 'Panel de Control',
                input: 'password',
                inputPlaceholder: 'Clave Admin para limpiar muro',
                showCancelButton: true
            });

            if (pass === CLAVE_ADMIN) {
                const { isConfirmed } = await Swal.fire({
                    title: '¬øVaciado Completo?',
                    text: "Se borrar√°n todos los pedidos y agradecimientos.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'S√≠, borrar todo',
                    confirmButtonColor: '#d33'
                });
                if (isConfirmed) {
                    iasdDB.clearAll();
                    Swal.fire('Limpio', 'Base de datos reiniciada', 'success');
                }
            }
        }

        async function descargarReportePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const todasLasPublicaciones = iasdDB.get('pedidos') || [];

    // 1. Generaci√≥n del PDF (Logo y contenido)
    try {
        const logoImg = new Image();
        logoImg.src = 'imagenes/logo.jpg'; 
        await new Promise((resolve) => {
            logoImg.onload = () => {
                doc.addImage(logoImg, 'JPEG', 15, 10, 25, 25);
                resolve();
            };
            logoImg.onerror = () => resolve();
        });
    } catch (e) { console.error(e); }

    doc.setFontSize(18);
    doc.setTextColor(0, 48, 94);
    doc.text("REPORTE DE ORACI√ìN - IASD LIMACHE", 45, 22);

    doc.autoTable({
        startY: 40,
        head: [['Fecha', 'Nombre', 'Tipo', 'Contenido']],
        body: todasLasPublicaciones.map(p => [p.date, p.name, p.category, p.content]),
        theme: 'striped',
        headStyles: { fillColor: [0, 48, 94] }
    });

    // 2. Descargar el archivo
    const nombreArchivo = `Reporte_IASD_${new Date().toLocaleDateString().replace(/\//g, '-')}.pdf`;
    doc.save(nombreArchivo);

    // 3. ENV√çO DIRECTO V√çA GMAIL (WEB Y APP)
    const destinatarios = "hildateresasandoval@gmail.com,iasdsanfranciscodelimache@gmail.com";
    const asunto = encodeURIComponent("Reporte de Oraci√≥n - San Francisco de Limache");
    const cuerpo = encodeURIComponent(
        "Hola,\n\nAdjunto el reporte de oraci√≥n generado.\n\n" +
        "PASO FINAL: Por favor, adjunta el archivo '" + nombreArchivo + "' que se acaba de descargar.\n\n" +
        "Bendiciones."
    );

    // Creamos el enlace espec√≠fico de Gmail
    // Este enlace fuerza la apertura en Gmail Web o App de Gmail en m√≥viles
    const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${destinatarios}&su=${asunto}&body=${cuerpo}`;

    // Peque√±a confirmaci√≥n antes de saltar a Gmail
    const { isConfirmed } = await Swal.fire({
        title: '¬°Reporte Listo!',
        text: 'El PDF se ha descargado. Ahora abriremos Gmail para enviarlo.',
        icon: 'success',
        confirmButtonText: 'Ir a Gmail',
        confirmButtonColor: '#d93025' // Color rojo Gmail
    });

    if (isConfirmed) {
        // Abrir en una pesta√±a nueva para no cerrar la App
        window.open(gmailUrl, '_blank');
    }
}

        // Inicializaci√≥n
        actualizarInterfaz();
    </script>
</body> 
</html>