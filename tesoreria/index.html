<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesoreria Pro | IASD Limache</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a192f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>

<body>
    <div id="toast-container"></div>

    <div id="login-screen"
        style="height: 100vh; display: flex; align-items: center; justify-content: center; background: #0a192f; color: white;">
        <div class="glass-form"
            style="text-align: center; max-width: 400px; background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px;">
            <i class="fas fa-church" style="font-size: 3rem; color: #c5a059; margin-bottom: 20px;"></i>
            <h2>Acceso Tesorería</h2>
            <p>IASD San Francisco de Limache</p>
            <input type="password" id="input-pass" placeholder="Contraseña"
                style="margin-top: 20px; text-align: center; padding: 12px; width: 100%; border-radius: 8px;">
            <button class="btn-action" onclick="validarAcceso()" style="width: 100%; margin-top: 20px;">Entrar al
                Sistema</button>
            <a href="https://iasdsflim.netlify.app/" style="display:block; margin-top:20px; color:#c5a059; text-decoration:none; font-size:0.9rem;">
                <i class="fas fa-arrow-left"></i> Volver al Sitio de la Iglesia
            </a>
        </div>
    </div>

    <div id="main-app" style="display: none;">
        <div class="app-layout" style="display: flex; height: 100vh;">
            <div id="sidebar-overlay" onclick="toggleSidebar()"></div>
            <aside class="sidebar"
                style="width: 260px; background: #0a192f; color: white; padding: 20px; display: flex; flex-direction: column;">
                <div class="brand-box" style="margin-bottom: 30px; font-weight: bold; color: #c5a059;">
                    <i class="fas fa-church"></i> <span>IASD San Francisco de Limache</span>
                </div>
                <nav class="main-nav" style="display: flex; flex-direction: column; gap: 10px; flex: 1;">
                    <button class="nav-btn active" onclick="showTab('dashboard')"><i class="fas fa-chart-pie"></i>
                        Dashboard</button>
                    <button class="nav-btn" onclick="showTab('ingresos')"><i class="fas fa-plus-circle"></i>
                        Ingresos</button>
                    <button class="nav-btn" onclick="showTab('egresos')"><i class="fas fa-receipt"></i>
                        Gastos/Rendición</button>
                    <button class="nav-btn" onclick="showTab('historial')"><i class="fas fa-history"></i>
                        Historial</button>
                    <button class="nav-btn" onclick="showTab('config')"><i class="fas fa-gears"></i> Ajustes %</button>
                </nav>
                <button class="btn-report" onclick="generarReportePDF()"
                    style="background: #c5a059; color: #0a192f; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    <i class="fas fa-file-pdf"></i> Generar Reporte PDF
                </button>
                <button class="btn-backup" onclick="limpiarRegistros()" style="background: #e74c3c; margin-top: 10px;">
                    <i class="fas fa-trash-alt"></i> Limpiar Registros
                </button>
            </aside>

            <main class="main-content" style="flex: 1; padding: 30px; overflow-y: auto; background: #f4f7f6;">
                <button id="menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>

                <header class="bank-summary" style="display: flex; gap: 20px; margin-bottom: 30px;">
                    <div class="bank-card"
                        style="background: #3498db; color: white; padding: 20px; border-radius: 15px; flex: 1;">
                        <p>BancoEstado</p>
                        <h2 id="total-estado">$0</h2>
                    </div>
                    <div class="bank-card"
                        style="background: #c5a059; color: white; padding: 20px; border-radius: 15px; flex: 1;">
                        <p>Banco Chile</p>
                        <h2 id="total-chile">$0</h2>
                    </div>
                    <div class="bank-card"
                        style="background: #2ecc71; color: white; padding: 20px; border-radius: 15px; flex: 1; cursor: pointer;"
                        onclick="verTotalGeneral()">
                        <p>Patrimonio Total</p>
                        <h2 id="total-iglesia">Ver Total</h2>
                    </div>
                </header>

                <section id="tab-dashboard" class="tab-view active">
                    <div
                        style="background: white; padding: 20px; border-radius: 20px; margin-bottom: 20px; height: 300px;">
                        <canvas id="chartPresupuesto"></canvas>
                    </div>
                    <div id="grid-departamentos" class="smart-grid"></div>
                    <h3 style="margin: 20px 0;">Ofrendas Dirigidas (Fondos Exclusivos)</h3>
                    <div id="grid-proyectos-reunido" class="smart-grid"></div>
                </section>

                <section id="tab-ingresos" class="tab-view" style="display:none;">
                    <div class="glass-form"
                        style="background: white; padding: 30px; border-radius: 20px; max-width: 800px; margin: auto;">
                        <h3 style="color: #0a192f; margin-bottom: 20px;"><i class="fas fa-plus-circle"></i> Registrar
                            Entrada de Fondos</h3>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Monto $</label>
                                <input type="number" id="monto-in" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label>N° Remesa</label>
                                <input type="text" id="remesa-num" placeholder="Ej: 001-2026">
                            </div>
                            <div class="form-group">
                                <label>Fecha de Ingreso</label>
                                <input type="date" id="fecha-in">
                            </div>
                            <div class="form-group">
                                <label>Cuenta Destino</label>
                                <select id="cuenta-in">
                                    <option value="estado">BancoEstado</option>
                                    <option value="chile">Banco Chile</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Fondo</label>
                                <select id="tipo-in" onchange="toggleInputs()">
                                    <option value="distribucion">Distribución % (Departamentos)</option>
                                    <option value="proyecto">Ofrenda Dirigida (Proyectos)</option>
                                </select>
                            </div>

                            <div id="wrapper-proyecto" style="display:none; grid-column: span 1;">
                                <label>Seleccionar Proyecto</label>
                                <select id="proj-select" onchange="checkNuevoConcepto()"></select>
                                <input type="text" id="nuevo-concepto-nombre" placeholder="Nombre del nuevo proyecto..."
                                    style="display:none; margin-top:15px; border: 2px solid #c5a059;">
                            </div>
                        </div>

                        <button class="btn-action" onclick="procesarIngreso()"
                            style="margin-top: 30px; width: 100%; font-size: 1.1rem;">
                            <i class="fas fa-check-double"></i> Integrar a Contabilidad
                        </button>
                    </div>
                </section>

                <section id="tab-egresos" class="tab-view" style="display:none;">
                    <div class="glass-form" style="background: white; padding: 30px; border-radius: 20px;">
                        <h3>Registrar Egreso / Rendición</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                            <select id="gasto-dep"></select>
                            <select id="gasto-banco">
                                <option value="estado">BancoEstado</option>
                                <option value="chile">Banco Chile</option>
                            </select>
                            <input type="text" id="gasto-director" placeholder="Director Responsable">
                            <input type="number" id="gasto-monto" placeholder="Monto $">
                            <input type="text" id="gasto-proposito" placeholder="¿En qué se ocupará?"
                                style="grid-column: span 2;">
                        </div>
                        <button class="btn-action" onclick="registrarGasto()"
                            style="margin-top: 20px; width: 100%;">Procesar Gasto</button>
                    </div>
                </section>

                <section id="tab-historial" class="tab-view" style="display:none;">
                    <div style="background: white; padding: 30px; border-radius: 20px;">
                        <h3>Historial de Movimientos Bancarios</h3>
                        <div id="lista-movimientos" style="margin-top: 20px;"></div>
                    </div>
                </section>

                <section id="tab-config" class="tab-view" style="display:none;">
                    <div class="glass-form" style="background: white; padding: 30px; border-radius: 20px;">
                        <h3>Configurar % de Departamentos</h3>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">La suma debe ser exactamente
                            100%.</p>
                        <div id="inputs-porcentajes" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        </div>
                        <div id="check-total"
                            style="margin-top: 20px; font-weight: bold; text-align: right; padding: 10px; background: #eee; border-radius: 8px;">
                            Suma: 0%</div>
                        <button class="btn-save" id="btn-guardar-config" onclick="guardarConfig()" disabled
                            style="margin-top: 20px; width: 100%;">Guardar Cambios</button>
                    </div>
                </section>

            </main>
        </div>
    </div>
    <script src="script.js"></script>
</body>

</html>